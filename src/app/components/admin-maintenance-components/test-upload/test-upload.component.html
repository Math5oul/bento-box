<div class="container">
  <div class="header">
    <h1>
      <img src="/imgs/bento-logo-mini.png" alt="Bento Box" class="logo" />
      Teste de Upload de Imagens
    </h1>
    <a routerLink="/maintenance/test-hub" class="back-button">‚Üê Voltar para Hub</a>
  </div>

  <div class="upload-section">
    <div class="upload-card">
      <h2>Upload de Imagem</h2>

      <div class="file-input-wrapper">
        <input
          type="file"
          id="fileInput"
          accept="image/*"
          (change)="onFileSelected($event)"
          class="file-input"
        />
        <label for="fileInput" class="file-label">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
          <span>{{ selectedFile ? selectedFile.name : 'Escolher Imagem' }}</span>
        </label>
      </div>

      @if (previewUrl) {
        <div class="preview-section">
          <h3>Preview:</h3>
          <img [src]="previewUrl" alt="Preview" class="preview-image" />
          <div class="file-info">
            <p><strong>Nome:</strong> {{ selectedFile?.name }}</p>
            <p>
              <strong>Tamanho:</strong> {{ (selectedFile?.size || 0) / 1024 | number: '1.0-2' }} KB
            </p>
            <p><strong>Tipo:</strong> {{ selectedFile?.type }}</p>
          </div>
        </div>
      }

      <div class="action-buttons">
        <button
          class="btn-upload"
          (click)="uploadImage()"
          [disabled]="!selectedFile || isUploading"
        >
          @if (!isUploading) {
            <span>Enviar Imagem</span>
          } @else {
            <span>Enviando...</span>
          }
        </button>
        <button class="btn-clear" (click)="clearSelection()" [disabled]="!selectedFile">
          Limpar
        </button>
      </div>

      @if (isUploading) {
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="uploadProgress"></div>
        </div>
      }

      @if (uploadMessage) {
        <div
          class="message"
          [class.success]="uploadProgress === 100"
          [class.error]="uploadProgress === 0 && uploadMessage"
        >
          {{ uploadMessage }}
        </div>
      }

      @if (uploadedImageUrl) {
        <div class="uploaded-result">
          <h3>Imagem Enviada:</h3>
          <img [src]="uploadedImageUrl" alt="Uploaded" class="result-image" />
          <p class="image-url">{{ uploadedImageUrl }}</p>
        </div>
      }
    </div>

    <div class="info-card">
      <h2>‚ÑπÔ∏è Informa√ß√µes</h2>
      <ul class="info-list">
        <li>
          <strong>Formatos Aceitos:</strong>
          <span>JPG, PNG, GIF, WebP, AVIF</span>
        </li>
        <li>
          <strong>Tamanho M√°ximo:</strong>
          <span>10MB</span>
        </li>
        <li>
          <strong>Endpoint:</strong>
          <code>/api/upload/:productId</code>
        </li>
        <li>
          <strong>Product ID (Teste):</strong>
          <code>{{ productId }}</code>
        </li>
        <li>
          <strong>M√©todo:</strong>
          <code>POST</code>
        </li>
        <li>
          <strong>Content-Type:</strong>
          <code>multipart/form-data</code>
        </li>
        <li>
          <strong>Campo do Form:</strong>
          <code>images</code>
        </li>
      </ul>

      <div class="tips">
        <h3>üí° Dicas:</h3>
        <ul>
          <li>Upload requer um productId v√°lido</li>
          <li>Imagens s√£o salvas em /assets/images/:productId/</li>
          <li>Suporta upload de at√© 10 imagens simult√¢neas</li>
          <li>URLs retornadas s√£o relativas ao servidor</li>
          <li>Cada teste usa um ID √∫nico tempor√°rio</li>
        </ul>
      </div>
    </div>
  </div>
</div>
