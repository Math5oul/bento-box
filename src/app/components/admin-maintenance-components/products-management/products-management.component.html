<div class="products-management-container">
  <!-- Header com logo e bot√£o voltar -->
  <div class="header">
    <h1>
      <img src="/imgs/bento-logo-mini.png" alt="Bento Box" class="logo" />
      Gerenciamento de Produtos
    </h1>
    <p class="subtitle">Gerencie os Produtos do sistema</p>
    <a routerLink="/maintenance/test-hub" class="back-button">‚Üê Voltar para Hub</a>
  </div>

  <!-- Estat√≠sticas -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon">üì¶</div>
      <div class="stat-info">
        <div class="stat-value">{{ totalProducts }}</div>
        <div class="stat-label">Total de Produtos</div>
      </div>
    </div>

    <div class="stat-card available">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-info">
        <div class="stat-value">{{ availableProducts }}</div>
        <div class="stat-label">Dispon√≠veis</div>
      </div>
    </div>

    <div class="stat-card unavailable">
      <div class="stat-icon">‚ùå</div>
      <div class="stat-info">
        <div class="stat-value">{{ unavailableProducts }}</div>
        <div class="stat-label">Indispon√≠veis</div>
      </div>
    </div>
  </div>

  <!-- Bot√£o de criar produto -->
  <div class="actions-container">
    <button class="create-button" (click)="openCreateModal()">‚ûï Criar Novo Produto</button>
  </div>

  <!-- Barra de Pesquisa -->
  <div class="search-section">
    <div class="search-bar">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        placeholder="üîç Pesquisar produtos por nome, descri√ß√£o ou categoria..."
        class="search-input"
      />
      @if (searchTerm) {
        <button class="clear-search" (click)="searchTerm = ''">&times;</button>
      }
    </div>
    <p class="search-results">
      Exibindo {{ filteredProducts.length }} de {{ products.length }} produtos
    </p>
  </div>

  <!-- Loading -->
  @if (loading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Carregando produtos...</p>
    </div>
  }

  <!-- Grid de produtos -->
  @if (!loading) {
    <div class="products-grid">
      @if (filteredProducts.length === 0 && products.length > 0) {
        <div class="empty-state">
          <p>Nenhum produto encontrado com "{{ searchTerm }}"</p>
        </div>
      }

      @for (product of filteredProducts; track product._id) {
        <div class="product-card" [class.unavailable]="!product.available">
          <!-- Badge de disponibilidade -->
          <div
            class="availability-badge"
            [class.available]="product.available"
            (click)="toggleAvailability(product)"
            title="Clique para alterar disponibilidade"
          >
            {{ product.available ? '‚úÖ Dispon√≠vel' : '‚ùå Indispon√≠vel' }}
          </div>

          <!-- Informa√ß√µes do produto -->
          <div class="product-info">
            <h3>{{ product.name }}</h3>
            <p class="description">{{ truncateText(product.description, 80) }}</p>

            <div class="product-meta">
              <span class="category">
                {{ getCategoryEmoji(product.category) }} {{ product.category }}
              </span>
              <span class="price">{{ formatPrice(product.price) }}</span>
            </div>

            <div class="product-details">
              @if (product.format) {
                <span class="detail-tag">üìê {{ product.format }}</span>
              }
              @if (product.colorMode) {
                <span class="detail-tag">
                  {{ product.colorMode === 'light' ? '‚òÄÔ∏è' : 'üåô' }} {{ product.colorMode }}
                </span>
              }
              <span class="detail-tag">üñºÔ∏è {{ product.images.length || 0 }} imagens</span>
            </div>
          </div>

          <!-- Miniatura das imagens -->
          @if (product.images && product.images.length > 0) {
            <div class="product-images">
              @for (img of product.images.slice(0, 3); track $index) {
                <img [src]="img" [alt]="product.name" class="thumbnail" />
              }
              @if (product.images.length > 3) {
                <span class="more-images"> +{{ product.images.length - 3 }} </span>
              }
            </div>
          }

          <!-- A√ß√µes -->
          <div class="product-actions">
            <button class="edit-btn" (click)="openEditModal(product)">‚úèÔ∏è Editar</button>
            <button class="delete-btn" (click)="deleteProduct(product._id)">üóëÔ∏è Deletar</button>
          </div>
        </div>
      }

      <!-- Mensagem quando n√£o h√° produtos -->
      @if (products.length === 0) {
        <div class="empty-state">
          <div class="empty-icon">üì¶</div>
          <h3>Nenhum produto cadastrado</h3>
          <p>Clique em "Criar Novo Produto" para adicionar o primeiro produto</p>
        </div>
      }
    </div>
  }

  <!-- Modal Unificado (new-item-modal) -->
  @if (showModal) {
    <app-new-item-modal
      [mode]="'product'"
      [editMode]="modalEditMode"
      [itemToEdit]="modalItemToEdit"
      (itemCreated)="onItemCreated($event)"
      (modalClosed)="closeModal()"
    ></app-new-item-modal>
  }
</div>
