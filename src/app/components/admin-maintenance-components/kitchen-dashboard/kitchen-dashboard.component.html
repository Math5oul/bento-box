<app-admin-header></app-admin-header>

<div class="kitchen-dashboard">
  <div class="page-title">
    <h1>üçΩÔ∏è Painel da Cozinha</h1>
    <p class="subtitle">Acompanhamento de Pedidos em Tempo Real</p>
  </div>

  <!-- Filters Bar -->
  <div class="filters-bar">
    <div class="filter-item">
      <label class="filter-label">Filtrar por Status:</label>
      <select [(ngModel)]="filterStatus" (change)="loadOrders()" class="filter-select">
        @for (s of statuses; track s.value) {
          <option [value]="s.value">{{ s.label }}</option>
        }
      </select>
    </div>
    <div class="order-count">
      <span class="count-label">Total:</span>
      <span class="count-value">{{ orders.length }}</span>
      <span class="count-suffix">pedido(s)</span>
    </div>
  </div>

  @if (loading) {
    <div class="loading">‚è≥ Carregando pedidos...</div>
  } @else if (error) {
    <div class="error-message">‚ùå {{ error }}</div>
  } @else {
    <div class="orders-container">
      <!-- Pedidos Ativos -->
      <div class="section-header">
        <h2>üî• Ativos</h2>
        <span class="section-count">{{ orders.length }}</span>
      </div>

      @if (orders.length === 0) {
        <div class="empty-state">
          <div class="empty-icon">üì≠</div>
          <h3>Nenhum pedido ativo</h3>
          <p class="empty-hint">Aguarde novos pedidos chegarem.</p>
        </div>
      } @else {
        <div class="orders-grid">
          @for (order of orders; track order.id) {
            <div class="order-card" [class]="getStatusClass(order.status)">
              <div class="order-card-header">
                <div class="order-badge">
                  <span
                    class="status-badge"
                    [class]="'badge-' + order.status"
                    [title]="'ID: ' + order.id"
                  >
                    {{ getStatusLabel(order.status) }}
                  </span>
                </div>
                <div class="order-meta">
                  <div class="meta-item">
                    <span class="meta-icon">üçΩÔ∏è</span>
                    <span class="meta-text">Mesa {{ order.tableNumber || '‚Äî' }}</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-icon">‚è±Ô∏è</span>
                    <span class="meta-text">{{ getElapsedTime(order.createdAt) }}</span>
                  </div>
                </div>
              </div>

              <div class="order-client">
                <span class="client-icon">üë§</span>
                <span class="client-name">{{ order.clientName || 'Cliente' }}</span>
              </div>

              <div class="order-items">
                <h4 class="items-title">Itens do Pedido:</h4>
                <ul class="items-list">
                  @for (item of order.items; track i; let i = $index) {
                    <li class="item-row">
                      <span class="item-quantity">{{ item.quantity }}x</span>
                      <span class="item-name">{{ item.productName }}</span>
                    </li>
                    @if (item.notes) {
                      <li class="item-notes">
                        <span class="notes-icon">üìù</span>
                        {{ item.notes }}
                      </li>
                    }
                  }
                </ul>
              </div>

              <div class="order-actions">
                <div class="actions-title">A√ß√µes:</div>
                <div class="actions-buttons">
                  @if (getNextStatus(order.status)) {
                    <button
                      class="action-btn"
                      (click)="updateStatus(order, getNextStatus(order.status)!)"
                      [class]="'btn-' + getNextStatus(order.status)"
                    >
                      {{ getNextStatusLabel(order.status) }}
                    </button>
                  }

                  <button
                    class="action-btn btn-cancelled"
                    (click)="updateStatus(order, 'cancelled')"
                    title="Cancelar pedido"
                  >
                    Cancelar
                  </button>
                </div>
              </div>
            </div>
          }
        </div>
      }

      <!-- Hist√≥rico de Pedidos -->
      @if (historyOrders.length > 0) {
        <div class="history-section">
          <div class="section-header">
            <h2><span class="history-icon">üìú</span> Hist√≥rico</h2>
            <button class="toggle-history-btn" (click)="showHistory = !showHistory">
              {{ showHistory ? '‚ñº Ocultar' : '‚ñ∂ Mostrar' }}
            </button>
          </div>

          @if (showHistory) {
            <div class="orders-grid">
              @for (order of historyOrders; track order.id) {
                <div class="order-card" [class]="getStatusClass(order.status)">
                  <div class="order-card-header">
                    <div class="order-badge">
                      <span class="order-number">#{{ order.id.slice(-6) }}</span>
                      <span class="status-badge" [class]="'badge-' + order.status">
                        {{ getStatusLabel(order.status) }}
                      </span>
                    </div>
                    <div class="order-meta">
                      <div class="meta-item">
                        <span class="meta-icon">üçΩÔ∏è</span>
                        <span class="meta-text">Mesa {{ order.tableNumber || '‚Äî' }}</span>
                      </div>
                      <div class="meta-item">
                        <span class="meta-icon">‚è∞</span>
                        <span class="meta-text">{{ getElapsedTime(order.createdAt) }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="order-client">
                    <span class="client-icon">üë§</span>
                    <span class="client-name">{{ order.clientName || 'Cliente' }}</span>
                  </div>

                  <div class="order-items">
                    <h4 class="items-title">Itens do Pedido:</h4>
                    <ul class="items-list">
                      @for (item of order.items; track item.productName) {
                        <li class="item">
                          <span class="item-quantity">{{ item.quantity }}x</span>
                          <span class="item-name">{{ item.productName }}</span>

                          @if (item.notes) {
                            <span class="item-notes">
                              <span class="notes-icon">üìù</span>
                              {{ item.notes }}
                            </span>
                          }
                        </li>
                      }
                    </ul>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>
