<app-admin-header></app-admin-header>

<div class="kitchen-dashboard">
  <div class="page-title">
    <h1>ğŸ½ï¸ Painel da Cozinha</h1>
    <p class="subtitle">Acompanhamento de Pedidos em Tempo Real</p>
  </div>

  <!-- Filters Bar -->
  <div class="filters-bar">
    <div class="filter-item">
      <label class="filter-label">Filtrar por Status:</label>
      <select [(ngModel)]="filterStatus" (change)="loadOrders()" class="filter-select">
        @for (s of statuses; track s.value) {
          <option [value]="s.value">{{ s.label }}</option>
        }
      </select>
    </div>
    <div class="order-count">
      <span class="count-label">Total:</span>
      <span class="count-value">{{ orders.length }}</span>
      <span class="count-suffix">pedido(s)</span>
    </div>
  </div>

  @if (loading) {
    <div class="loading">â³ Carregando pedidos...</div>
  } @else if (error) {
    <div class="error-message">âŒ {{ error }}</div>
  } @else {
    <div class="orders-container">
      <!-- Pedidos Ativos -->
      <div class="section-header">
        <h2>ğŸ”¥ Ativos</h2>
        <span class="section-count">{{ orders.length }}</span>
      </div>

      @if (orders.length === 0) {
        <div class="empty-state">
          <div class="empty-icon">ğŸ“­</div>
          <h3>Nenhum pedido ativo</h3>
          <p class="empty-hint">Aguarde novos pedidos chegarem.</p>
        </div>
      } @else {
        <div class="orders-grid">
          @for (order of orders; track order.id) {
            <div class="order-card" [class]="getStatusClass(order.status)">
              <div class="order-card-header">
                <div class="order-badge">
                  <span
                    class="status-badge"
                    [class]="'badge-' + order.status"
                    [title]="'ID: ' + order.id"
                  >
                    {{ getStatusLabel(order.status) }}
                  </span>
                </div>
                <div class="order-meta">
                  <div class="meta-item">
                    <span class="meta-icon">ğŸ½ï¸</span>
                    <span class="meta-text">Mesa {{ order.tableNumber || 'â€”' }}</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-icon">â±ï¸</span>
                    <span class="meta-text">{{ getElapsedTime(order.createdAt) }}</span>
                  </div>
                </div>
              </div>

              <div class="order-client">
                <span class="client-icon">ğŸ‘¤</span>
                <span class="client-name">{{ order.clientName || 'Cliente' }}</span>
              </div>

              <div class="order-items">
                <h4 class="items-title">Itens do Pedido:</h4>
                <ul class="items-list">
                  @for (item of order.items; track i; let i = $index) {
                    <li class="item-row">
                      <div class="item-main-row">
                        <span class="item-quantity">{{ item.quantity }}x</span>
                        <span class="item-name">{{ item.productName }}</span>
                        @if (item.selectedSize) {
                          <div class="item-size">ğŸ”¹ {{ item.selectedSize.abbreviation }}</div>
                        }
                        @if (item.selectedVariation) {
                          <div class="item-variation">ğŸ”¸ {{ item.selectedVariation.title }}</div>
                        }
                        @if (item.notes) {
                          <div class="item-notes">
                            <span class="notes-icon">ğŸ“</span> {{ item.notes }}
                          </div>
                        }
                      </div>

                      <div class="item-action">
                        @if ((item.status || 'pending') === 'pending') {
                          <button
                            class="small-btn btn-preparing"
                            (click)="updateItemStatus(order, item, 'preparing')"
                            title="Marcar preparando"
                          >
                            Preparar
                          </button>
                        } @else if ((item.status || 'pending') === 'preparing') {
                          <button
                            class="small-btn btn-ready"
                            (click)="updateItemStatus(order, item, 'ready')"
                            title="Marcar pronto"
                          >
                            Pronto
                          </button>
                        } @else if ((item.status || 'pending') === 'ready') {
                          <span class="ready-pill" title="Pronto para entrega"
                            >Pronto para entrega âœ“</span
                          >
                        } @else if ((item.status || 'pending') === 'delivered') {
                          <span class="delivered-pill" title="Entregue">Entregue âœ“</span>
                        }
                      </div>
                    </li>
                  }
                </ul>
              </div>

              <div class="order-actions">
                <div class="actions-buttons">
                  <button
                    class="action-btn btn-cancelled"
                    (click)="updateStatus(order, 'cancelled')"
                    title="Cancelar pedido"
                  >
                    Cancelar
                  </button>
                </div>
              </div>
            </div>
          }
        </div>
      }

      <!-- HistÃ³rico de Pedidos -->
      @if (historyOrders.length > 0) {
        <div class="history-section">
          <div class="section-header">
            <h2><span class="history-icon">ğŸ“œ</span> HistÃ³rico</h2>
            <button class="toggle-history-btn" (click)="showHistory = !showHistory">
              {{ showHistory ? 'â–¼ Ocultar' : 'â–¶ Mostrar' }}
            </button>
          </div>

          @if (showHistory) {
            <div class="orders-grid">
              @for (order of historyOrders; track order.id) {
                <div class="order-card" [class]="getStatusClass(order.status)">
                  <div class="order-card-header">
                    <div class="order-badge">
                      <span class="order-number">#{{ order.id.slice(-6) }}</span>
                      <span class="status-badge" [class]="'badge-' + order.status">{{
                        getStatusLabel(order.status)
                      }}</span>
                    </div>
                    <div class="order-meta">
                      <div class="meta-item">
                        <span class="meta-icon">ğŸ½ï¸</span>
                        <span class="meta-text">Mesa {{ order.tableNumber || 'â€”' }}</span>
                      </div>
                      <div class="meta-item">
                        <span class="meta-icon">â°</span>
                        <span class="meta-text">{{ getElapsedTime(order.createdAt) }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="order-client">
                    <span class="client-icon">ğŸ‘¤</span>
                    <span class="client-name">{{ order.clientName || 'Cliente' }}</span>
                  </div>

                  <div class="order-items">
                    <h4 class="items-title">Itens do Pedido:</h4>
                    <ul class="items-list">
                      @for (item of order.items; track i; let i = $index) {
                        <li class="item">
                          <span class="item-quantity">{{ item.quantity }}x</span>
                          <span class="item-name">{{ item.productName }}</span>
                          @if (item.selectedSize) {
                            <div class="item-size">
                              ğŸ”¹ Tamanho: {{ item.selectedSize.name }} ({{
                                item.selectedSize.abbreviation
                              }})
                            </div>
                          }
                          @if (item.selectedVariation) {
                            <div class="item-variation">
                              ğŸ”¸ VariaÃ§Ã£o: {{ item.selectedVariation.title }}
                              @if (item.selectedVariation.description) {
                                â€” {{ item.selectedVariation.description }}
                              }
                            </div>
                          }
                          @if (item.notes) {
                            <span class="item-notes"
                              ><span class="notes-icon">ğŸ“</span> {{ item.notes }}</span
                            >
                          }
                        </li>
                      }
                    </ul>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>
