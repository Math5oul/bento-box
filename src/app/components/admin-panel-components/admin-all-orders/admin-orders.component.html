<div class="admin-orders">
  <div class="orders-header">
    <h2>üì¶ Pedidos por Mesa</h2>
    @if (!isLoading && !error) {
      <div class="summary-badge">
        <span class="badge-label">Total:</span>
        <span class="badge-value">{{ getTotalOrders() }} pedidos</span>
      </div>
    }
  </div>

  @if (isLoading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Carregando pedidos...</p>
    </div>
  }

  @if (error) {
    <div class="error">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error }}</p>
    </div>
  }

  @if (!isLoading && !error) {
    @for (mesa of ordersByTable; track mesa.tableNumber) {
      <div class="mesa-block" [attr.data-table-number]="mesa.tableNumber">
        <div class="mesa-header">
          <div class="mesa-info">
            <div class="mesa-icon">ü™ë</div>
            <h3>Mesa {{ mesa.tableNumber }}</h3>
          </div>
          @if (mesa.orders.length > 0) {
            <div class="mesa-stats">
              <span class="stat-badge stat-orders">
                <span class="stat-icon">üìã</span>
                {{ mesa.orders.length }} pedido{{ mesa.orders.length > 1 ? 's' : '' }}
              </span>
              <span class="stat-badge stat-revenue">
                <span class="stat-icon">üí∞</span>
                R$ {{ getMesaTotal(mesa).toFixed(2) }}
              </span>
            </div>
          }
        </div>

        @if (mesa.orders.length === 0) {
          <div class="no-orders">
            <span class="no-orders-icon">üì≠</span>
            <p>Nenhum pedido nesta mesa</p>
          </div>
        }

        <div class="orders-grid">
          @for (order of mesa.orders; track order.id) {
            <div class="order-card" [class.order-highlight]="isHighlighted(order)">
              <div class="order-header">
                <div class="order-left">
                  <div class="order-avatar">{{ order.clientName.charAt(0).toUpperCase() }}</div>
                  <div class="order-info">
                    <div class="order-id">#{{ order.id.substring(0, 8) }}</div>
                    <div class="order-client">{{ order.clientName }}</div>
                  </div>
                </div>
                <div class="order-right">
                  <span class="order-status" [attr.data-status]="order.status">
                    {{ getStatusLabel(order.status) }}
                  </span>
                </div>
              </div>

              <div class="order-body">
                <div class="order-items">
                  <div class="items-header">
                    <span class="items-icon">üçΩÔ∏è</span>
                    <span class="items-title">Itens do Pedido</span>
                  </div>
                  <ul class="items-list">
                    @for (item of order.items; track i; let i = $index) {
                      <li class="item-row">
                        <div class="item-name-container">
                          <span class="item-name">{{ item.productName }}</span>
                          @if (item.selectedSize) {
                            <small class="item-size"
                              >{{ item.selectedSize.abbreviation }} -
                              {{ item.selectedSize.name }}</small
                            >
                          }
                        </div>
                        <div class="item-details">
                          @if (item.quantity) {
                            <span class="item-qty">x{{ item.quantity }}</span>
                          }
                          @if (item.unitPrice) {
                            <span class="item-price"
                              >R$ {{ (item.unitPrice * (item.quantity || 1)).toFixed(2) }}</span
                            >
                          }
                        </div>
                      </li>
                    }
                  </ul>
                </div>

                @if (order.notes) {
                  <div class="order-notes">
                    <span class="notes-icon">üìù</span>
                    <span class="notes-text">{{ order.notes }}</span>
                  </div>
                }
              </div>

              <div class="order-footer">
                <div class="order-time">
                  <span class="time-icon">üïí</span>
                  <span>{{ getOrderTime(order) }}</span>
                </div>
                <div class="order-total">
                  <span class="total-label">Total:</span>
                  <span class="total-value">R$ {{ order.totalAmount.toFixed(2) }}</span>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    } @empty {
      <div class="empty-state">
        <span class="empty-icon">üì≠</span>
        <h3>Nenhum pedido encontrado</h3>
        <p>Quando houver pedidos ativos, eles aparecer√£o aqui.</p>
      </div>
    }
  }
</div>
