<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Central de Manuten√ß√£o - Bento Box</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      h1 {
        color: white;
        text-align: center;
        margin-bottom: 10px;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .subtitle {
        color: rgba(255, 255, 255, 0.9);
        text-align: center;
        margin-bottom: 30px;
        font-size: 1.1em;
      }

      .nav-links {
        text-align: center;
        margin-bottom: 20px;
      }

      .nav-links a {
        color: white;
        text-decoration: none;
        margin: 0 15px;
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        transition: all 0.3s;
      }

      .nav-links a:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .section {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .section h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.8em;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
      }

      .fillers-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .filler-card {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        background: #f9f9f9;
        transition: all 0.3s;
        display: flex;
        flex-direction: column;
      }

      .filler-card:hover {
        border-color: #667eea;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        transform: translateY(-2px);
      }

      .filler-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .filler-type {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: 600;
        text-transform: uppercase;
      }

      .type-text {
        background: #e3f2fd;
        color: #1976d2;
      }

      .type-image {
        background: #f3e5f5;
        color: #7b1fa2;
      }

      .type-video {
        background: #fff3e0;
        color: #f57c00;
      }

      .filler-id {
        font-size: 0.8em;
        color: #999;
      }

      .filler-content {
        margin: 15px 0;
        padding: 15px;
        background: white;
        border-radius: 6px;
        border-left: 4px solid #667eea;
      }

      .filler-content p {
        margin: 8px 0;
        color: #555;
        font-size: 0.95em;
        word-break: break-word;
      }

      .filler-content .url-text {
        display: block;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: #667eea;
        font-family: monospace;
        font-size: 0.85em;
      }

      .filler-content strong {
        color: #333;
      }

      .filler-meta {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin: 10px 0;
        font-size: 0.9em;
        color: #666;
      }

      .filler-actions {
        display: flex;
        gap: 10px;
        margin-top: auto;
        padding-top: 15px;
      }

      .btn {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9em;
      }

      .btn-edit {
        background: #4caf50;
        color: white;
      }

      .btn-edit:hover {
        background: #45a049;
        transform: translateY(-2px);
      }

      .btn-delete {
        background: #f44336;
        color: white;
      }

      .btn-delete:hover {
        background: #da190b;
        transform: translateY(-2px);
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }

      .empty-state svg {
        width: 100px;
        height: 100px;
        margin-bottom: 20px;
        opacity: 0.3;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #667eea;
        font-size: 1.2em;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-header h3 {
        color: #667eea;
        font-size: 1.5em;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
        color: #999;
      }

      .close-btn:hover {
        color: #333;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #555;
        font-weight: 600;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
        font-family: inherit;
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
      }

      .stat-value {
        font-size: 2.5em;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9em;
        opacity: 0.9;
      }

      .categories-container,
      .formats-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }

      .category-option {
        display: flex;
        align-items: center;
        padding: 10px;
        background: #f5f5f5;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .category-option:hover {
        background: #e8e8e8;
      }

      .category-option input[type='checkbox'] {
        width: auto;
        margin-right: 8px;
        cursor: pointer;
      }

      .category-option.selected {
        background: #e3f2fd;
        border-color: #667eea;
      }

      .category-hint {
        font-size: 0.85em;
        color: #666;
        margin-top: 8px;
        padding: 8px;
        background: #fff3cd;
        border-left: 3px solid #ffc107;
        border-radius: 4px;
      }

      .category-hint.success {
        background: #d4edda;
        border-color: #28a745;
        color: #155724;
      }

      .preview-container {
        margin: 10px 0;
        border-radius: 6px;
        overflow: hidden;
        max-height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f0f0f0;
      }

      .preview-image {
        max-width: 100%;
        max-height: 150px;
        object-fit: contain;
      }

      .preview-video {
        max-width: 100%;
        max-height: 150px;
      }

      .preview-text {
        padding: 15px;
        border-radius: 6px;
        min-height: 80px;
        max-height: 150px;
        overflow: hidden;
        font-size: 0.9em;
        line-height: 1.4;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üõ†Ô∏è Central de Manuten√ß√£o</h1>
      <p class="subtitle">Gerencie os Fillers do sistema</p>

      <div class="nav-links">
        <a href="/">‚Üê Voltar ao App</a>
        <a href="/docs.html">üìö Documenta√ß√£o</a>
        <a href="/maintenance-hub.html">üß™ Central de Manuten√ß√£o</a>
      </div>

      <!-- Estat√≠sticas -->
      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="totalFillers">0</div>
          <div class="stat-label">Total de Fillers</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="textFillers">0</div>
          <div class="stat-label">Fillers de Texto</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="imageFillers">0</div>
          <div class="stat-label">Fillers de Imagem</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="videoFillers">0</div>
          <div class="stat-label">Fillers de V√≠deo</div>
        </div>
      </div>

      <!-- Se√ß√£o de Fillers -->
      <div class="section">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
          "
        >
          <h2 style="margin: 0">üì¶ Fillers Cadastrados</h2>
          <div style="display: flex; gap: 10px">
            <button class="btn-primary" onclick="openCreateModal()">‚ûï Novo Filler</button>
            <button class="btn-primary" onclick="loadFillers()">üîÑ Recarregar</button>
          </div>
        </div>

        <div id="fillersContainer" class="loading">Carregando fillers...</div>
      </div>
    </div>

    <!-- Modal de Edi√ß√£o -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>‚úèÔ∏è Editar Filler</h3>
          <button class="close-btn" onclick="closeEditModal()">&times;</button>
        </div>

        <form id="editForm" onsubmit="saveFiller(event)">
          <input type="hidden" id="editFillerId" />

          <div class="form-group">
            <label>Tipo</label>
            <select id="editType" onchange="updateEditForm()" required>
              <option value="text">Texto</option>
              <option value="image">Imagem</option>
              <option value="video">V√≠deo</option>
            </select>
          </div>

          <div id="textFields" style="display: none">
            <div class="form-group">
              <label>Texto (HTML permitido)</label>
              <textarea id="editText" rows="4"></textarea>
            </div>
            <div class="form-group">
              <label>Cor de Fundo</label>
              <div style="display: flex; gap: 10px; align-items: center">
                <div style="position: relative; display: inline-block">
                  <input
                    type="color"
                    id="editBackgroundColor"
                    value="#ffffff"
                    style="
                      width: 60px;
                      height: 40px;
                      cursor: pointer;
                      border: 2px solid #ddd;
                      border-radius: 6px;
                    "
                  />
                </div>
                <input
                  type="text"
                  id="editBackgroundColorText"
                  value="#ffffff"
                  style="
                    flex: 1;
                    padding: 10px;
                    border: 2px solid #e0e0e0;
                    border-radius: 6px;
                    font-family: monospace;
                    font-weight: bold;
                  "
                  readonly
                />
                <div
                  id="editColorPreview"
                  style="
                    width: 40px;
                    height: 40px;
                    border: 2px solid #ddd;
                    border-radius: 6px;
                    background: #ffffff;
                  "
                ></div>
              </div>
            </div>
          </div>

          <div id="imageFields" style="display: none">
            <div class="form-group">
              <label>URL da Imagem</label>
              <input type="text" id="editImageUrl" />
            </div>
            <div class="form-group">
              <label>Texto Alternativo</label>
              <input type="text" id="editImageAlt" />
            </div>
          </div>

          <div id="videoFields" style="display: none">
            <div class="form-group">
              <label>URL do V√≠deo</label>
              <input type="text" id="editVideoUrl" />
            </div>
            <div class="form-group">
              <label class="category-option">
                <input type="checkbox" id="editVideoAutoplay" />
                <span>‚ñ∂Ô∏è Autoplay</span>
              </label>
              <label class="category-option">
                <input type="checkbox" id="editVideoControls" />
                <span>üéÆ Mostrar Controles</span>
              </label>
              <label class="category-option">
                <input type="checkbox" id="editVideoLoop" />
                <span>üîÅ Loop</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Formatos V√°lidos</label>
            <div class="formats-container">
              <label class="category-option">
                <input type="checkbox" value="1x1" class="format-checkbox-edit" />
                <span>üìê 1x1 (Quadrado)</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="1x2" class="format-checkbox-edit" />
                <span>üìè 2x1 (Horizontal)</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="2x1" class="format-checkbox-edit" />
                <span>üìè 1x2 (Vertical)</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="2x2" class="format-checkbox-edit" />
                <span>üì¶ 2x2 (Grande)</span>
              </label>
            </div>
            <div id="editFormatHint" class="category-hint">‚úÖ 0 formato(s) selecionado(s)</div>
          </div>

          <div class="form-group">
            <label>Categorias</label>
            <div class="categories-container">
              <label class="category-option">
                <input type="checkbox" value="food" onchange="updateCategoryHint('edit')" />
                <span>ü•ê Pratos</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="hot beverage" onchange="updateCategoryHint('edit')" />
                <span>‚òï Bebidas Quentes</span>
              </label>
              <label class="category-option">
                <input
                  type="checkbox"
                  value="cold beverage"
                  onchange="updateCategoryHint('edit')"
                />
                <span>ü•§ Bebidas Frias</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="dessert" onchange="updateCategoryHint('edit')" />
                <span>üç∞ Sobremesas</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="alcoholic" onchange="updateCategoryHint('edit')" />
                <span>üç∫ Bebidas Alco√≥licas</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="beverage" onchange="updateCategoryHint('edit')" />
                <span>üçπ Bebidas</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="other" onchange="updateCategoryHint('edit')" />
                <span>üì¶ Outros</span>
              </label>
            </div>
            <div id="editCategoryHint" class="category-hint">
              ‚ö†Ô∏è Selecione pelo menos uma categoria para que o item apare√ßa no menu
            </div>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="editActive" style="width: auto; margin-right: 5px" />
              Ativo
            </label>
          </div>

          <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px">
            üíæ Salvar Altera√ß√µes
          </button>
        </form>
      </div>
    </div>

    <!-- Modal de Cria√ß√£o -->
    <div id="createModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>‚ûï Criar Novo Filler</h3>
          <button class="close-btn" onclick="closeCreateModal()">&times;</button>
        </div>

        <form id="createForm" onsubmit="createFiller(event)">
          <div class="form-group">
            <label>Tipo *</label>
            <select id="createType" onchange="updateCreateForm()" required>
              <option value="">Selecione um tipo</option>
              <option value="text">üìù Texto</option>
              <option value="image">üñºÔ∏è Imagem</option>
              <option value="video">üé• V√≠deo</option>
            </select>
          </div>

          <div id="createTextFields" style="display: none">
            <div class="form-group">
              <label>Texto (HTML permitido) *</label>
              <textarea
                id="createText"
                rows="4"
                placeholder="Digite o texto do filler..."
              ></textarea>
            </div>
            <div class="form-group">
              <label>Cor de Fundo *</label>
              <div style="display: flex; gap: 10px; align-items: center">
                <div style="position: relative; display: inline-block">
                  <input
                    type="color"
                    id="createBackgroundColor"
                    value="#ffffff"
                    style="
                      width: 60px;
                      height: 40px;
                      cursor: pointer;
                      border: 2px solid #ddd;
                      border-radius: 6px;
                    "
                  />
                </div>
                <input
                  type="text"
                  id="createBackgroundColorText"
                  value="#ffffff"
                  style="
                    flex: 1;
                    padding: 10px;
                    border: 2px solid #e0e0e0;
                    border-radius: 6px;
                    font-family: monospace;
                    font-weight: bold;
                  "
                  readonly
                />
                <div
                  id="createColorPreview"
                  style="
                    width: 40px;
                    height: 40px;
                    border: 2px solid #ddd;
                    border-radius: 6px;
                    background: #ffffff;
                  "
                ></div>
              </div>
            </div>
          </div>

          <div id="createImageFields" style="display: none">
            <div class="form-group">
              <label>URL da Imagem *</label>
              <input type="text" id="createImageUrl" placeholder="https://exemplo.com/imagem.jpg" />
            </div>
            <div class="form-group">
              <label>Texto Alternativo</label>
              <input type="text" id="createImageAlt" placeholder="Descri√ß√£o da imagem" />
            </div>
          </div>

          <div id="createVideoFields" style="display: none">
            <div class="form-group">
              <label>URL do V√≠deo *</label>
              <input type="text" id="createVideoUrl" placeholder="https://exemplo.com/video.mp4" />
            </div>
            <div class="form-group">
              <label class="category-option">
                <input type="checkbox" id="createVideoAutoplay" />
                <span>‚ñ∂Ô∏è Autoplay</span>
              </label>
              <label class="category-option">
                <input type="checkbox" id="createVideoControls" checked />
                <span>üéÆ Mostrar Controles</span>
              </label>
              <label class="category-option">
                <input type="checkbox" id="createVideoLoop" />
                <span>üîÅ Loop</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Formatos V√°lidos *</label>
            <div class="formats-container">
              <label class="category-option">
                <input type="checkbox" value="1x1" class="format-checkbox-create" checked />
                <span>üìê 1x1 (Quadrado)</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="1x2" class="format-checkbox-create" />
                <span>üìè 1x2 (Horizontal)</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="2x1" class="format-checkbox-create" />
                <span>üìè 2x1 (Vertical)</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="2x2" class="format-checkbox-create" />
                <span>üì¶ 2x2 (Grande)</span>
              </label>
            </div>
            <div id="createFormatHint" class="category-hint">‚úÖ 1 formato(s) selecionado(s)</div>
          </div>

          <div class="form-group">
            <label>Categorias *</label>
            <div class="categories-container">
              <label class="category-option">
                <input type="checkbox" value="food" onchange="updateCategoryHint('create')" />
                <span>ü•ê Pratos</span>
              </label>
              <label class="category-option">
                <input
                  type="checkbox"
                  value="hot beverage"
                  onchange="updateCategoryHint('create')"
                />
                <span>‚òï Bebidas Quentes</span>
              </label>
              <label class="category-option">
                <input
                  type="checkbox"
                  value="cold beverage"
                  onchange="updateCategoryHint('create')"
                />
                <span>ü•§ Bebidas Frias</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="dessert" onchange="updateCategoryHint('create')" />
                <span>üç∞ Sobremesas</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="alcoholic" onchange="updateCategoryHint('create')" />
                <span>üç∫ Bebidas Alco√≥licas</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="beverage" onchange="updateCategoryHint('create')" />
                <span>üçπ Bebidas</span>
              </label>
              <label class="category-option">
                <input type="checkbox" value="other" onchange="updateCategoryHint('create')" />
                <span>üì¶ Outros</span>
              </label>
            </div>
            <div id="createCategoryHint" class="category-hint">
              ‚ö†Ô∏è Selecione pelo menos uma categoria para que o item apare√ßa no menu
            </div>
          </div>

          <div class="form-group">
            <label>
              <input
                type="checkbox"
                id="createActive"
                checked
                style="width: auto; margin-right: 5px"
              />
              Ativo
            </label>
          </div>

          <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px">
            ‚ú® Criar Filler
          </button>
        </form>
      </div>
    </div>

    <script>
      const API_URL = 'http://localhost:3001/api';

      /**
       * Garante que o texto tenha formata√ß√£o centralizada
       * Remove estilos conflitantes e envolve em div centralizada se necess√°rio
       */
      function ensureCenteredText(text) {
        if (!text) return text;

        // Remove estilos inline que possam interferir no alinhamento
        let processedText = text
          .replace(/text-align:\s*left/gi, 'text-align: center')
          .replace(/text-align:\s*right/gi, 'text-align: center')
          .replace(/text-align:\s*justify/gi, 'text-align: center');

        // Se o texto n√£o cont√©m tags de estilo de alinhamento, adiciona
        if (!processedText.includes('text-align') && !processedText.includes('style=')) {
          // Envolve par√°grafos e headings com estilo centralizado
          processedText = processedText
            .replace(/<p>/gi, '<p style="text-align: center;">')
            .replace(/<h1>/gi, '<h1 style="text-align: center;">')
            .replace(/<h2>/gi, '<h2 style="text-align: center;">')
            .replace(/<h3>/gi, '<h3 style="text-align: center;">')
            .replace(/<h4>/gi, '<h4 style="text-align: center;">')
            .replace(/<h5>/gi, '<h5 style="text-align: center;">')
            .replace(/<h6>/gi, '<h6 style="text-align: center;">');

          // Se n√£o h√° tags HTML, envolve em div centralizada
          if (!processedText.includes('<')) {
            processedText = `<div style="text-align: center;">${processedText}</div>`;
          }
        }

        return processedText;
      }

      // Carrega os fillers ao iniciar
      document.addEventListener('DOMContentLoaded', () => {
        loadFillers();

        // Sincroniza os color pickers com os campos de texto e preview
        const editColorPicker = document.getElementById('editBackgroundColor');
        const editColorText = document.getElementById('editBackgroundColorText');
        const editColorPreview = document.getElementById('editColorPreview');
        const createColorPicker = document.getElementById('createBackgroundColor');
        const createColorText = document.getElementById('createBackgroundColorText');
        const createColorPreview = document.getElementById('createColorPreview');

        editColorPicker.addEventListener('input', e => {
          const color = e.target.value.toUpperCase();
          editColorText.value = color;
          editColorPreview.style.background = color;
        });

        createColorPicker.addEventListener('input', e => {
          const color = e.target.value.toUpperCase();
          createColorText.value = color;
          createColorPreview.style.background = color;
        });

        // Adiciona event listeners para checkboxes de formato
        document.querySelectorAll('.format-checkbox-edit').forEach(checkbox => {
          checkbox.addEventListener('change', () => updateFormatHint('edit'));
        });

        document.querySelectorAll('.format-checkbox-create').forEach(checkbox => {
          checkbox.addEventListener('change', () => updateFormatHint('create'));
        });

        // Atualiza hints iniciais
        updateFormatHint('create');
      });

      async function loadFillers() {
        const container = document.getElementById('fillersContainer');
        container.innerHTML = '<div class="loading">Carregando fillers...</div>';

        try {
          const response = await fetch(`${API_URL}/fillers`);
          const fillers = await response.json();

          console.log('Fillers carregados:', fillers);

          // Atualiza estat√≠sticas
          document.getElementById('totalFillers').textContent = fillers.length;
          document.getElementById('textFillers').textContent = fillers.filter(
            f => f.type === 'text'
          ).length;
          document.getElementById('imageFillers').textContent = fillers.filter(
            f => f.type === 'image'
          ).length;
          document.getElementById('videoFillers').textContent = fillers.filter(
            f => f.type === 'video'
          ).length;

          if (fillers.length === 0) {
            container.innerHTML = `
              <div class="empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                </svg>
                <h3>Nenhum Filler encontrado</h3>
                <p>Crie fillers atrav√©s do aplicativo principal</p>
              </div>
            `;
            return;
          }

          container.innerHTML = `<div class="fillers-grid">${fillers.map(renderFillerCard).join('')}</div>`;
        } catch (error) {
          console.error('Erro ao carregar fillers:', error);
          container.innerHTML = `
            <div class="empty-state">
              <h3 style="color: #f44336;">‚ùå Erro ao carregar fillers</h3>
              <p>${error.message}</p>
            </div>
          `;
        }
      }

      function renderFillerCard(filler) {
        const typeClass = `type-${filler.type}`;
        const typeEmoji = filler.type === 'text' ? 'üìù' : filler.type === 'image' ? 'üñºÔ∏è' : 'üé•';

        let contentHtml = '';
        let previewHtml = '';

        if (filler.type === 'text') {
          const bgColor = filler.content.backgroundColor || '#ffffff';
          const displayText = filler.content.text || 'Vazio';
          const truncatedText =
            displayText.length > 100 ? displayText.substring(0, 100) + '...' : displayText;

          previewHtml = `
            <div class="preview-container">
              <div class="preview-text" style="background-color: ${bgColor}; width: 100%;">
                ${displayText.substring(0, 150)}${displayText.length > 150 ? '...' : ''}
              </div>
            </div>
          `;

          contentHtml = `
            <p><strong>Texto:</strong> ${truncatedText}</p>
            <p><strong>Cor de Fundo:</strong> <span style="display: inline-block; width: 20px; height: 20px; background: ${bgColor}; border: 1px solid #ccc; vertical-align: middle; border-radius: 3px;"></span> ${bgColor}</p>
          `;
        } else if (filler.type === 'image') {
          const url = filler.content.url || 'N√£o definido';
          const alt = filler.content.alt || 'Sem texto alternativo';

          previewHtml = `
            <div class="preview-container">
              <img src="${url}" alt="${alt}" class="preview-image" onerror="this.style.display='none'; this.parentElement.innerHTML='<p style=\'color:#999; padding:20px;\'>‚ùå Erro ao carregar imagem</p>';" />
            </div>
          `;

          contentHtml = `
            <p><strong>URL:</strong> <span class="url-text" title="${url}">${url}</span></p>
            <p><strong>Alt:</strong> ${alt}</p>
          `;
        } else if (filler.type === 'video') {
          const url = filler.content.url || 'N√£o definido';

          previewHtml = `
            <div class="preview-container">
              <video src="${url}" class="preview-video" controls muted onerror="this.style.display='none'; this.parentElement.innerHTML='<p style=\'color:#999; padding:20px;\'>‚ùå Erro ao carregar v√≠deo</p>';"></video>
            </div>
          `;

          contentHtml = `<p><strong>URL:</strong> <span class="url-text" title="${url}">${url}</span></p>`;
        }

        // Formata categorias
        const categories = filler.categories || [];
        const categoryEmojis = {
          food: 'ü•ê',
          'hot beverage': '‚òï',
          'cold beverage': 'ü•§',
          dessert: 'üç∞',
          alcoholic: 'üç∫',
          beverage: 'üçπ',
          other: 'üì¶',
        };
        const categoriesHtml =
          categories.length > 0
            ? categories.map(cat => `${categoryEmojis[cat] || 'üì¶'}`).join(' ')
            : '‚ö†Ô∏è Sem categorias';

        // Formata os formatos v√°lidos para exibi√ß√£o
        const formatsDisplay = (filler.formats || ['1x1']).join(', ');

        return `
          <div class="filler-card">
            <div class="filler-header">
              <span class="filler-type ${typeClass}">${typeEmoji} ${filler.type}</span>
              <span class="filler-id">#${filler._id.substring(0, 8)}</span>
            </div>

            ${previewHtml}

            <div class="filler-content">
              ${contentHtml}
            </div>

            <div class="filler-meta">
              <div><strong>Formatos:</strong> ${formatsDisplay}</div>
              <div><strong>Status:</strong> ${filler.active ? '‚úÖ Ativo' : '‚ùå Inativo'}</div>
              <div><strong>Posi√ß√£o:</strong> (${filler.gridPosition?.row || 0}, ${filler.gridPosition?.col || 0})</div>
              <div style="grid-column: 1 / -1;"><strong>Categorias:</strong> ${categoriesHtml}</div>
            </div>

            <div class="filler-actions">
              <button class="btn btn-edit" onclick='editFiller(${JSON.stringify(filler)})'>‚úèÔ∏è Editar</button>
              <button class="btn btn-delete" onclick="deleteFiller('${filler._id}')">üóëÔ∏è Deletar</button>
            </div>
          </div>
        `;
      }

      function editFiller(filler) {
        document.getElementById('editFillerId').value = filler._id;
        document.getElementById('editType').value = filler.type;
        document.getElementById('editActive').checked = filler.active;

        // Preenche campos espec√≠ficos
        const bgColor = filler.content.backgroundColor || '#ffffff';
        document.getElementById('editText').value = filler.content.text || '';
        document.getElementById('editBackgroundColor').value = bgColor;
        document.getElementById('editBackgroundColorText').value = bgColor.toUpperCase();
        document.getElementById('editColorPreview').style.background = bgColor;
        document.getElementById('editImageUrl').value = filler.content.url || '';
        document.getElementById('editImageAlt').value = filler.content.alt || '';
        document.getElementById('editVideoUrl').value = filler.content.url || '';
        document.getElementById('editVideoAutoplay').checked = filler.content.autoplay || false;
        document.getElementById('editVideoControls').checked =
          filler.content.controls !== undefined ? filler.content.controls : true;
        document.getElementById('editVideoLoop').checked = filler.content.loop || false;

        // Carrega formatos
        const formats = filler.formats || ['1x1'];
        const formatCheckboxes = document.querySelectorAll('.format-checkbox-edit');

        formatCheckboxes.forEach(checkbox => {
          checkbox.checked = formats.includes(checkbox.value);
          if (checkbox.checked) {
            checkbox.parentElement.classList.add('selected');
          } else {
            checkbox.parentElement.classList.remove('selected');
          }
        });

        console.log('üìê Formatos carregados:', formats);

        // Carrega categorias
        const categories = filler.categories || [];
        const editModal = document.getElementById('editModal');
        const checkboxes = editModal.querySelectorAll(
          '.categories-container input[type="checkbox"]'
        );

        checkboxes.forEach(checkbox => {
          checkbox.checked = categories.includes(checkbox.value);
          if (checkbox.checked) {
            checkbox.parentElement.classList.add('selected');
          } else {
            checkbox.parentElement.classList.remove('selected');
          }
        });

        console.log('üìã Categorias carregadas:', categories);

        updateEditForm();
        updateCategoryHint('edit');
        updateFormatHint('edit');
        document.getElementById('editModal').classList.add('active');
      }

      function updateEditForm() {
        const type = document.getElementById('editType').value;

        document.getElementById('textFields').style.display = type === 'text' ? 'block' : 'none';
        document.getElementById('imageFields').style.display = type === 'image' ? 'block' : 'none';
        document.getElementById('videoFields').style.display = type === 'video' ? 'block' : 'none';
      }

      function closeEditModal() {
        document.getElementById('editModal').classList.remove('active');
      }

      function openCreateModal() {
        // Reset form
        document.getElementById('createForm').reset();
        document.getElementById('createType').value = '';
        updateCreateForm();
        document.getElementById('createModal').classList.add('active');
      }

      function closeCreateModal() {
        document.getElementById('createModal').classList.remove('active');
      }

      function updateCategoryHint(mode) {
        const modalPrefix = mode === 'edit' ? 'editModal' : 'createModal';
        const hintId = mode === 'edit' ? 'editCategoryHint' : 'createCategoryHint';
        const modal = document.getElementById(modalPrefix);
        const checkboxes = modal.querySelectorAll('.categories-container input[type="checkbox"]');
        const hint = document.getElementById(hintId);

        let selectedCount = 0;
        checkboxes.forEach(checkbox => {
          if (checkbox.checked) {
            selectedCount++;
            checkbox.parentElement.classList.add('selected');
          } else {
            checkbox.parentElement.classList.remove('selected');
          }
        });

        if (selectedCount === 0) {
          hint.className = 'category-hint';
          hint.textContent =
            '‚ö†Ô∏è Selecione pelo menos uma categoria para que o item apare√ßa no menu';
        } else {
          hint.className = 'category-hint success';
          hint.textContent = `‚úÖ Este item aparecer√° em ${selectedCount} categoria(s)`;
        }
      }

      function updateFormatHint(mode) {
        const hintId = mode === 'edit' ? 'editFormatHint' : 'createFormatHint';
        const className = mode === 'edit' ? '.format-checkbox-edit' : '.format-checkbox-create';
        const checkboxes = document.querySelectorAll(className);
        const hint = document.getElementById(hintId);

        let selectedCount = 0;
        checkboxes.forEach(checkbox => {
          if (checkbox.checked) {
            selectedCount++;
            checkbox.parentElement.classList.add('selected');
          } else {
            checkbox.parentElement.classList.remove('selected');
          }
        });

        if (selectedCount === 0) {
          hint.className = 'category-hint';
          hint.textContent = '‚ö†Ô∏è Selecione pelo menos um formato v√°lido';
        } else {
          hint.className = 'category-hint success';
          hint.textContent = `‚úÖ ${selectedCount} formato(s) selecionado(s)`;
        }
      }

      function getSelectedFormats(mode) {
        const className = mode === 'edit' ? '.format-checkbox-edit' : '.format-checkbox-create';
        const checkboxes = document.querySelectorAll(className);
        const selected = [];

        checkboxes.forEach(checkbox => {
          if (checkbox.checked) {
            selected.push(checkbox.value);
          }
        });

        return selected;
      }

      function getSelectedCategories(mode) {
        const modalPrefix = mode === 'edit' ? 'editModal' : 'createModal';
        const modal = document.getElementById(modalPrefix);
        const checkboxes = modal.querySelectorAll('.categories-container input[type="checkbox"]');
        const selected = [];

        checkboxes.forEach(checkbox => {
          if (checkbox.checked) {
            selected.push(checkbox.value);
          }
        });

        return selected;
      }

      function updateCreateForm() {
        const type = document.getElementById('createType').value;

        document.getElementById('createTextFields').style.display =
          type === 'text' ? 'block' : 'none';
        document.getElementById('createImageFields').style.display =
          type === 'image' ? 'block' : 'none';
        document.getElementById('createVideoFields').style.display =
          type === 'video' ? 'block' : 'none';
      }

      async function createFiller(event) {
        event.preventDefault();

        const type = document.getElementById('createType').value;
        const active = document.getElementById('createActive').checked;
        const categories = getSelectedCategories('create');
        const formats = getSelectedFormats('create');

        console.log('üîç Categorias selecionadas:', categories);
        console.log('üìê Formatos selecionados:', formats);

        if (!type) {
          alert('‚ö†Ô∏è Selecione um tipo de filler!');
          return;
        }

        if (categories.length === 0) {
          alert('‚ö†Ô∏è Selecione pelo menos uma categoria!');
          return;
        }

        if (formats.length === 0) {
          alert('‚ö†Ô∏è Selecione pelo menos um formato!');
          return;
        }

        let content = {};
        if (type === 'text') {
          const text = document.getElementById('createText').value;
          if (!text) {
            alert('‚ö†Ô∏è O campo de texto √© obrigat√≥rio!');
            return;
          }
          // Processa o texto para garantir formata√ß√£o centralizada
          content.text = ensureCenteredText(text);
          content.backgroundColor = document.getElementById('createBackgroundColor').value;
        } else if (type === 'image') {
          const url = document.getElementById('createImageUrl').value;
          if (!url) {
            alert('‚ö†Ô∏è A URL da imagem √© obrigat√≥ria!');
            return;
          }
          content.url = url;
          content.alt = document.getElementById('createImageAlt').value || 'Imagem do filler';
        } else if (type === 'video') {
          const url = document.getElementById('createVideoUrl').value;
          if (!url) {
            alert('‚ö†Ô∏è A URL do v√≠deo √© obrigat√≥ria!');
            return;
          }
          content.url = url;
          content.autoplay = document.getElementById('createVideoAutoplay').checked;
          content.controls = document.getElementById('createVideoControls').checked;
          content.loop = document.getElementById('createVideoLoop').checked;
        }

        const newFiller = {
          type,
          content,
          categories,
          formats,
          active,
          gridPosition: { row: 0, col: 0, rowSpan: 1, colSpan: 1 },
        };

        console.log('üì¶ Criando filler com dados completos:', JSON.stringify(newFiller, null, 2));

        try {
          const response = await fetch(`${API_URL}/fillers`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(newFiller),
          });

          const responseData = await response.json();
          console.log('üì® Resposta do servidor:', responseData);

          if (!response.ok) {
            throw new Error(responseData.message || 'Erro ao criar filler');
          }

          console.log('‚úÖ Filler criado com sucesso:', responseData);

          alert('‚úÖ Filler criado com sucesso!');
          closeCreateModal();
          loadFillers();
        } catch (error) {
          console.error('‚ùå Erro ao criar:', error);
          alert('‚ùå Erro ao criar filler: ' + error.message);
        }
      }

      async function saveFiller(event) {
        event.preventDefault();

        const fillerId = document.getElementById('editFillerId').value;
        const type = document.getElementById('editType').value;
        const active = document.getElementById('editActive').checked;
        const categories = getSelectedCategories('edit');
        const formats = getSelectedFormats('edit');

        console.log('üîç Categorias selecionadas para edi√ß√£o:', categories);
        console.log('üìê Formatos selecionados para edi√ß√£o:', formats);

        if (categories.length === 0) {
          alert('‚ö†Ô∏è Selecione pelo menos uma categoria!');
          return;
        }

        if (formats.length === 0) {
          alert('‚ö†Ô∏è Selecione pelo menos um formato!');
          return;
        }

        let content = {};
        if (type === 'text') {
          // Processa o texto para garantir formata√ß√£o centralizada
          content.text = ensureCenteredText(document.getElementById('editText').value);
          content.backgroundColor = document.getElementById('editBackgroundColor').value;
        } else if (type === 'image') {
          content.url = document.getElementById('editImageUrl').value;
          content.alt = document.getElementById('editImageAlt').value;
        } else if (type === 'video') {
          content.url = document.getElementById('editVideoUrl').value;
          content.autoplay = document.getElementById('editVideoAutoplay').checked;
          content.controls = document.getElementById('editVideoControls').checked;
          content.loop = document.getElementById('editVideoLoop').checked;
        }

        const updateData = {
          type,
          content,
          categories,
          formats,
          active,
        };

        console.log(
          'üìù Atualizando filler com dados completos:',
          JSON.stringify(updateData, null, 2)
        );

        try {
          const response = await fetch(`${API_URL}/fillers/${fillerId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(updateData),
          });

          const responseData = await response.json();
          console.log('üì® Resposta do servidor:', responseData);

          if (!response.ok) {
            throw new Error(responseData.message || 'Erro ao atualizar filler');
          }

          console.log('‚úÖ Filler atualizado com sucesso:', responseData);

          alert('‚úÖ Filler atualizado com sucesso!');
          closeEditModal();
          loadFillers();
        } catch (error) {
          console.error('‚ùå Erro ao salvar:', error);
          alert('‚ùå Erro ao atualizar filler: ' + error.message);
        }
      }

      async function deleteFiller(fillerId) {
        if (!confirm('Tem certeza que deseja deletar este filler?')) {
          return;
        }

        try {
          const response = await fetch(`${API_URL}/fillers/${fillerId}`, {
            method: 'DELETE',
          });

          if (!response.ok) {
            throw new Error('Erro ao deletar filler');
          }

          alert('‚úÖ Filler deletado com sucesso!');
          loadFillers();
        } catch (error) {
          console.error('Erro ao deletar:', error);
          alert('‚ùå Erro ao deletar filler: ' + error.message);
        }
      }
    </script>
  </body>
</html>
