<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de Upload - Bento Box</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
      }
      .container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }
      h1 {
        color: #667eea;
        margin-top: 0;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
      }
      h2 {
        color: #764ba2;
        margin-top: 30px;
      }
      input,
      button {
        margin: 10px 0;
        padding: 12px;
        font-size: 14px;
        border-radius: 8px;
        border: 2px solid #ddd;
        width: 100%;
        box-sizing: border-box;
      }
      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.2s;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }
      button:active {
        transform: translateY(0);
      }
      #response {
        margin-top: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        border-radius: 5px;
        white-space: pre-wrap;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        max-height: 400px;
        overflow-y: auto;
      }
      .success {
        background: #d4edda;
        border-color: #28a745;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border-color: #dc3545;
        color: #721c24;
      }
      label {
        display: block;
        font-weight: bold;
        margin-top: 15px;
        color: #555;
      }
      .section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }
      .images-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
      }
      .images-preview img {
        max-width: 150px;
        max-height: 150px;
        border-radius: 8px;
        border: 2px solid #ddd;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üç± Teste de Upload - Bento Box MongoDB</h1>
      <p>Backend rodando em: <strong id="apiUrl">http://localhost:3001</strong></p>

      <!-- Teste 1: Upload de Imagens -->
      <div class="section">
        <h2>1. Upload de Imagens</h2>
        <label for="uploadProductId">Product ID:</label>
        <input type="text" id="uploadProductId" placeholder="Ex: 67419d8f9a2b3c4d5e6f7890" />

        <label for="uploadFiles">Selecione imagens (m√°x 10):</label>
        <input type="file" id="uploadFiles" multiple accept="image/*" />

        <div id="uploadPreview" class="images-preview"></div>

        <button onclick="testUpload()">üì§ Upload Imagens</button>
      </div>

      <!-- Teste 2: Deletar Imagem -->
      <div class="section">
        <h2>2. Deletar Imagem Espec√≠fica</h2>
        <label for="deleteImagePath">Caminho da imagem:</label>
        <input type="text" id="deleteImagePath" placeholder="assets/images/productId/123456.jpg" />

        <label for="deleteImageProductId">Product ID (opcional):</label>
        <input type="text" id="deleteImageProductId" placeholder="ID do produto" />

        <button onclick="testDeleteImage()">üóëÔ∏è Deletar Imagem</button>
      </div>

      <!-- Teste 3: Deletar Pasta do Produto -->
      <div class="section">
        <h2>3. Deletar Pasta Completa</h2>
        <label for="deleteFolderProductId">Product ID:</label>
        <input type="text" id="deleteFolderProductId" placeholder="ID do produto" />

        <button onclick="testDeleteFolder()">üóëÔ∏è Deletar Pasta</button>
      </div>

      <!-- Teste 4: Renomear Pasta -->
      <div class="section">
        <h2>4. Renomear Pasta (Temp ‚Üí Definitivo)</h2>
        <label for="renameTempId">ID Tempor√°rio:</label>
        <input type="text" id="renameTempId" placeholder="temp-12345" />

        <label for="renameNewId">ID Definitivo:</label>
        <input type="text" id="renameNewId" placeholder="67419d8f9a2b3c4d5e6f7890" />

        <button onclick="testRename()">üîÑ Renomear Pasta</button>
      </div>

      <!-- Resposta -->
      <div id="response"></div>
    </div>

    <script>
      const API_BASE = 'http://localhost:3001/api';

      // Preview de imagens selecionadas
      document.getElementById('uploadFiles').addEventListener('change', function (e) {
        const preview = document.getElementById('uploadPreview');
        preview.innerHTML = '';

        Array.from(e.target.files).forEach(file => {
          const reader = new FileReader();
          reader.onload = function (event) {
            const img = document.createElement('img');
            img.src = event.target.result;
            preview.appendChild(img);
          };
          reader.readAsDataURL(file);
        });
      });

      async function testUpload() {
        const productId = document.getElementById('uploadProductId').value;
        const files = document.getElementById('uploadFiles').files;

        if (!productId || files.length === 0) {
          showResponse('‚ùå Preencha o Product ID e selecione imagens!', 'error');
          return;
        }

        const formData = new FormData();
        Array.from(files).forEach(file => {
          formData.append('images', file);
        });

        try {
          const response = await fetch(`${API_BASE}/upload/${productId}`, {
            method: 'POST',
            body: formData,
          });
          const data = await response.json();
          showResponse(JSON.stringify(data, null, 2), data.success ? 'success' : 'error');
        } catch (error) {
          showResponse(`‚ùå Erro: ${error.message}`, 'error');
        }
      }

      async function testDeleteImage() {
        const imagePath = document.getElementById('deleteImagePath').value;
        const productId = document.getElementById('deleteImageProductId').value;

        if (!imagePath) {
          showResponse('‚ùå Preencha o caminho da imagem!', 'error');
          return;
        }

        try {
          const response = await fetch(`${API_BASE}/upload/image`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ imagePath, productId }),
          });
          const data = await response.json();
          showResponse(JSON.stringify(data, null, 2), data.success ? 'success' : 'error');
        } catch (error) {
          showResponse(`‚ùå Erro: ${error.message}`, 'error');
        }
      }

      async function testDeleteFolder() {
        const productId = document.getElementById('deleteFolderProductId').value;

        if (!productId) {
          showResponse('‚ùå Preencha o Product ID!', 'error');
          return;
        }

        try {
          const response = await fetch(`${API_BASE}/upload/product/${productId}`, {
            method: 'DELETE',
          });
          const data = await response.json();
          showResponse(JSON.stringify(data, null, 2), data.success ? 'success' : 'error');
        } catch (error) {
          showResponse(`‚ùå Erro: ${error.message}`, 'error');
        }
      }

      async function testRename() {
        const tempId = document.getElementById('renameTempId').value;
        const newId = document.getElementById('renameNewId').value;

        if (!tempId || !newId) {
          showResponse('‚ùå Preencha ambos os IDs!', 'error');
          return;
        }

        try {
          const response = await fetch(`${API_BASE}/upload/${tempId}/rename/${newId}`, {
            method: 'POST',
          });
          const data = await response.json();
          showResponse(JSON.stringify(data, null, 2), data.success ? 'success' : 'error');
        } catch (error) {
          showResponse(`‚ùå Erro: ${error.message}`, 'error');
        }
      }

      function showResponse(message, type = '') {
        const responseDiv = document.getElementById('response');
        responseDiv.textContent = message;
        responseDiv.className = type;
      }
    </script>
  </body>
</html>
